<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>車両出品 | kakuBus-Market</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        textarea { height: 100px; }
        .btn-submit { background: #e60012; color: white; padding: 15px; border: none; border-radius: 4px; font-size: 1.1rem; cursor: pointer; width: 100%; font-weight: bold; }
        .btn-submit:disabled { background: #ccc; }
    </style>
</head>
<body>
    <header class="main-header">
        <h1 onclick="location.href='index.html'" style="cursor:pointer;">KAKUBus-Market</h1>
    </header>

    <main class="container">
        <div class="form-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h2 style="text-align:center; margin-bottom:20px;">車両を出品する</h2>
            
            <form id="postForm">
                <div class="form-group">
                    <label>車両写真（必須）</label>
                    <input type="file" id="imageInput" accept="image/*" required>
                    <div id="img-preview" style="margin-top:10px; height:200px; border:1px dashed #ccc; display:flex; align-items:center; justify-content:center; overflow:hidden;">
                        <span style="color:#888;">写真を選択してください</span>
                    </div>
                </div>

                <div class="form-group">
                    <label>車種名 / タイトル</label>
                    <input type="text" id="title" placeholder="例：観光バス エアロクイーン" required>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>メーカー</label>
                        <select id="maker" required>
                            <option value="">選択してください</option>
                            <option value="いすゞ">いすゞ</option>
                            <option value="日野">日野</option>
                            <option value="三菱ふそう">三菱ふそう</option>
                            <option value="日産ディーゼル">日産ディーゼル</option>
                            <option value="トヨタ">トヨタ</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>型式</label>
                        <input type="text" id="model" placeholder="例：2RG-MS06GP">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>サイズ</label>
                        <select id="size" required>
                            <option value="">選択してください</option>
                            <option value="大型">大型</option>
                            <option value="大型短尺">大型短尺</option>
                            <option value="中型">中型</option>
                            <option value="中型ロング">中型ロング</option>
                            <option value="中型ショート">中型ショート</option>
                            <option value="小型">小型</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>エンジン型式</label>
                        <input type="text" id="engine" placeholder="例：6M70">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>燃料</label>
                        <select id="fuel">
                            <option value="軽油">軽油</option>
                            <option value="ガソリン">ガソリン</option>
                            <option value="CNG">CNG</option>
                            <option value="その他">その他</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>排気量</label>
                        <input type="text" id="cc" placeholder="例：12.8L / 12800cc">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>走行距離</label>
                        <input type="text" id="mileage" placeholder="例：500,000km" required>
                    </div>
                    <div class="form-group">
                        <label>ミッション情報</label>
                        <input type="text" id="mission" placeholder="例：6速MT / 7速AMT">
                    </div>
                </div>

                <div class="form-group">
                    <label>車両状態・備考</label>
                    <textarea id="status" placeholder="修復歴の有無、エアコンの効き具合、タイヤの状態など詳細を記入してください"></textarea>
                </div>

                <button type="submit" id="submitBtn" class="btn-submit">出品を確定する</button>
            </form>
            <button class="nav-btn" onclick="location.href='index.html'" style="margin-top:15px; width:100%; background:#666;">キャンセル</button>
        </div>
    </main>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycby3rOg6yiVRe1sQWlMUi3TJcx_46mFyVz3oqlJGOkpeHkhrdOTIGhzRwhalBq4xMfyz/exec";
        let imageData = "";

        // 画像プレビュー
        document.getElementById('imageInput').onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                imageData = event.target.result;
                document.getElementById('img-preview').innerHTML = `<img src="${imageData}" style="width:100%; height:100%; object-fit:cover;">`;
            };
            reader.readAsDataURL(file);
        };

        // 送信処理
        document.getElementById('postForm').onsubmit = async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerText = "送信中...";

            const postData = {
                title: document.getElementById('title').value,
                maker: document.getElementById('maker').value,
                model: document.getElementById('model').value,
                size: document.getElementById('size').value,
                engine: document.getElementById('engine').value,
                fuel: document.getElementById('fuel').value,
                cc: document.getElementById('cc').value,
                mileage: document.getElementById('mileage').value,
                mission: document.getElementById('mission').value,
                status: document.getElementById('status').value,
                image: imageData,
                owner: localStorage.getItem('userNickname') || "ゲスト",
                email: localStorage.getItem('userEmail') || ""
            };

            try {
                await fetch(GAS_URL, {
                    method: "POST",
                    mode: "no-cors",
                    body: JSON.stringify(postData),
                    headers: { "Content-Type": "text/plain" }
                });

                setTimeout(() => {
                    alert("出品完了しました！");
                    location.href = "index.html";
                }, 1500);
            } catch (error) {
                alert("送信に失敗しました。");
                submitBtn.disabled = false;
                submitBtn.innerText = "出品を確定する";
            }
        };
    </script>
</body>
</html>