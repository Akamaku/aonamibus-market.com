<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>マイページ | Bus-Market</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="main-header">
        <h1 onclick="location.href='index.html'" style="cursor:pointer;">Bus-Market</h1>
        <div id="user-info" style="color:white;"></div>
    </header>

    <main class="container">
        <h2>あなたの出品一覧</h2>
        <div class="grid" id="my-vehicle-grid"></div>
    </main>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbyBgNRke_RVNCM2j4whbDWwDfzXTf1SxhgFwrujGVV5D7xQwNYmwKu96tNZweoH3B79/exec";
        const myEmail = localStorage.getItem('userEmail'); // ログイン時に保存したメルアド

        async function loadMyVehicles() {
            if (!myEmail) {
                alert("ログインが必要です");
                location.href = 'login.html';
                return;
            }

            const grid = document.getElementById('my-vehicle-grid');
            const response = await fetch(GAS_URL);
            const data = await response.json();

            // 自分のメールアドレスと一致するデータだけを抽出
            const myData = data.filter(v => v.email === myEmail);

            if (myData.length === 0) {
                grid.innerHTML = '<p>まだ出品している車両はありません。</p>';
                return;
            }

            myData.reverse().forEach(v => {
                grid.innerHTML += `
                    <div class="card">
                        <div class="card-img"><img src="${v.image || ''}"></div>
                        <div class="card-content">
                            <h3>${v.title}</h3>
                            <p>${v.maker} / ${v.model}</p>
                            <a href="detail.html?id=${v.id}" class="btn-detail">詳細・編集</a>
                        </div>
                    </div>`;
            });
        }
        window.onload = loadMyVehicles;
    </script>
</body>
</html>