<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒã‚¤ãƒšãƒ¼ã‚¸ | Bus-Market</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="main-header"><h1>ãƒã‚¤ãƒšãƒ¼ã‚¸</h1><a href="index.html">ãƒˆãƒƒãƒ—</a></header>
    <div class="container">
        <div class="card">
            <h2>ğŸ‘¤ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ: <span id="m-nick"></span></h2>
            <button onclick="localStorage.clear(); location.href='index.html';" class="btn-dark">å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ã—ã¦ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
        </div>

        <h3>ğŸ“¦ è‡ªåˆ†ã®å‡ºå“è»Šä¸¡ï¼ˆå–ã‚Šæ¶ˆã—ï¼‰</h3>
        <div id="my-list" class="grid"></div>

        <h3>â­ ãŠæ°—ã«å…¥ã‚Šãƒªã‚¹ãƒˆ</h3>
        <div id="fav-list" class="grid"></div>

        <h3>ğŸ•’ é–²è¦§å±¥æ­´</h3>
        <div id="history-list" class="grid"></div>
    </div>

    <script>
        const me = localStorage.getItem('userEmail');
        document.getElementById('m-nick').innerText = localStorage.getItem('userNickname');

        const all = JSON.parse(localStorage.getItem('allVehicles')) || [];
        const favs = JSON.parse(localStorage.getItem('userFavorites')) || [];
        const hists = JSON.parse(localStorage.getItem('viewHistory')) || [];

        // å‡ºå“å–æ¶ˆ
        all.filter(v => v.ownerEmail === me).forEach(v => {
            document.getElementById('my-list').innerHTML += `
                <div class="card">
                    <h4>${v.title}</h4>
                    <button onclick="delPost(${v.id})" class="admin-del">âŒ å‡ºå“ã‚’å–ã‚Šæ¶ˆã™</button>
                </div>`;
        });

        // ãŠæ°—ã«å…¥ã‚Š
        favs.forEach(f => {
            document.getElementById('fav-list').innerHTML += `<div class="card"><a href="detail.html?id=${f.id}">${f.title}</a></div>`;
        });

        // å±¥æ­´
        hists.reverse().forEach(h => {
            document.getElementById('history-list').innerHTML += `<div class="card" style="font-size:12px;"><b>${h.title}</b><br>${h.time}</div>`;
        });

        function delPost(id) {
            if(confirm("ã“ã®è»Šä¸¡ã®å‡ºå“ã‚’å–ã‚Šæ¶ˆã—ã¾ã™ã‹ï¼Ÿ")) {
                const updated = all.filter(v => v.id !== id);
                localStorage.setItem('allVehicles', JSON.stringify(updated));
                location.reload();
            }
        }
    </script>
</body>
</html>