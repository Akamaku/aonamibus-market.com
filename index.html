<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Bus-Market | ãƒã‚¹å–å¼•</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="main-header">
        <h1 onclick="location.href='index.html'" style="cursor:pointer;">Bus-Market</h1>
        <nav id="user-nav">
            </nav>
    </header>

    <div class="hero">
        <h1>ãƒ—ãƒ­ã®ãŸã‚ã®ãƒã‚¹å£²è²·ãƒãƒ¼ã‚±ãƒƒãƒˆ</h1>
        <p>ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚Œã°èª°ã§ã‚‚è‡ªç”±ã«å‡ºå“ãƒ»å…±æœ‰ãŒå¯èƒ½ã§ã™</p>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="è»Šç¨®ã€ãƒ¡ãƒ¼ã‚«ãƒ¼ã€çŠ¶æ…‹ã‹ã‚‰æ¢ã™...">
            <button onclick="searchVehicles()" class="btn-dark">æ¤œç´¢</button>
        </div>
    </div>

    <main class="container">
        <h2 style="border-left: 5px solid var(--red); padding-left: 15px; margin-bottom: 20px;">æœ€æ–°ã®å‡ºå“è»Šä¸¡</h2>
        <div class="grid" id="vehicle-grid">
            </div>
    </main>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxqifQGgA39sQ9SFTzphksRS2VESA2JIKbJ08FSa9O-PCCIxV9E3u2QAVaUCB8m0xx8/exec";

    // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã®ç¢ºèªã¨è¡¨ç¤º
    function updateHeader() {
        const nickname = localStorage.getItem('userNickname');
        const authBtn = document.getElementById('auth-btn'); // æ—¢å­˜ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³
        if (nickname && authBtn) {
            authBtn.innerHTML = `ğŸ‘¤ ${nickname}`;
        }
    }

    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¡¨ç¤º
    async function displayVehicles() {
        const grid = document.getElementById('vehicle-grid');
        grid.innerHTML = '<div class="empty-msg">èª­ã¿è¾¼ã¿ä¸­...</div>';

        try {
            const response = await fetch(GAS_URL);
            const all = await response.json();
            
            // æ–°ç€é †ï¼ˆé€†é †ï¼‰ã«ä¸¦ã¹æ›¿ãˆ
            all.reverse();

            grid.innerHTML = all.length ? '' : '<div class="empty-msg">å‡ºå“è»Šä¸¡ãŒã‚ã‚Šã¾ã›ã‚“</div>';

            all.forEach(v => {
                const imgTag = v.image ? `<img src="${v.image}" style="width:100%; height:100%; object-fit:cover;">` : 'NO IMAGE';
                grid.innerHTML += `
                    <div class="card">
                        <div class="card-img">${imgTag}</div>
                        <div class="card-content">
                            <h3 class="card-title">${v.title}</h3>
                            <p class="card-spec">${v.manufacturer} / ${v.mileage}</p>
                            <a href="detail.html?id=${v.id}" class="btn-red-small">è©³ç´°ã‚’è¦‹ã‚‹</a>
                            <div class="card-footer" style="margin-top:10px; font-size:11px; color:#666;">
                                å‡ºå“è€…: ${v.owner}
                            </div>
                        </div>
                    </div>`;
            });
        } catch (e) {
            grid.innerHTML = '<div class="empty-msg">ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ</div>';
        }
    }

    updateHeader();
    displayVehicles();
</script>
</body>
</html>