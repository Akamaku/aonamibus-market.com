<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Bus-Market | ãƒã‚¹å–å¼•</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="main-header">
        <a href="index.html" class="logo">Bus-Market</a>
        <nav>
            <a href="post.html">è»Šä¸¡ã‚’å‡ºå“</a>
            <a href="mypage.html" id="auth-btn">ãƒ­ã‚°ã‚¤ãƒ³</a>
        </nav>
    </header>

    <div class="hero">
        <h1>ãƒ—ãƒ­ã®ãŸã‚ã®ãƒã‚¹å£²è²·ãƒãƒ¼ã‚±ãƒƒãƒˆ</h1>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="è»Šç¨®ã€ãƒ¡ãƒ¼ã‚«ãƒ¼ã€çŠ¶æ…‹ã‹ã‚‰æ¢ã™...">
            <button onclick="searchVehicles()" class="btn-dark">æ¤œç´¢</button>
        </div>
    </div>

    <main class="container">
        <div class="grid" id="vehicle-grid"></div>
    </main>

    <script>
        const ADMIN_EMAIL = "akamaku.1rasuto@gmail.com";
        const nickname = localStorage.getItem('userNickname');
        const userEmail = localStorage.getItem('userEmail');

        if (nickname) {
            document.getElementById('auth-btn').innerHTML = `<span class="user-badge">ğŸ‘¤ ${nickname}</span>`;
        }

        function displayVehicles() {
            const grid = document.getElementById('vehicle-grid');
            let all = JSON.parse(localStorage.getItem('allVehicles')) || [];
            all.sort((a, b) => b.createdAt - a.createdAt);

            grid.innerHTML = all.length ? '' : '<div class="empty-msg">å‡ºå“è»Šä¸¡ãŒã‚ã‚Šã¾ã›ã‚“</div>';

            all.forEach(v => {
                const isAdmin = userEmail === ADMIN_EMAIL;
                const deleteBtn = isAdmin ? `<button onclick="adminDelete(${v.id})" class="admin-del">ğŸš¨ ç®¡ç†è€…å‰Šé™¤</button>` : '';
                const imgTag = v.image ? `<img src="${v.image}" style="width:100%; height:100%; object-fit:cover;">` : 'NO IMAGE';
                
                grid.innerHTML += `
                    <div class="card">
                        <div class="card-img">${imgTag}</div>
                        <div class="card-content">
                            <h3 class="card-title">${v.title}</h3>
                            <p class="card-spec">${v.manufacturer} / ${v.mileage}</p>
                            <a href="detail.html?id=${v.id}" class="btn-red-small">è©³ç´°ã‚’è¦‹ã‚‹</a>
                            <div class="card-footer">${deleteBtn} <span>å‡ºå“è€…: ${v.owner}</span></div>
                        </div>
                    </div>`;
            });
        }
        function adminDelete(id) {
            if(confirm("ã€ç®¡ç†è€…æ¨©é™ã€‘å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
                let all = JSON.parse(localStorage.getItem('allVehicles')).filter(v => v.id !== id);
                localStorage.setItem('allVehicles', JSON.stringify(all));
                location.reload();
            }
        }
        displayVehicles();
    </script>
</body>
</html>